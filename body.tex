% For formating purposes only 
\setcounter{chapter}{4}
%\listofalgorithms - think about it ...
%--------------
%- COPY START -
%--------------        
\chapter{(R) State of art}\label{ch:stateOfArt}

\noindent This  chapter is introducing notable works and concepts of fellow \emph{researchers} i the field of \emph{control theory}, \emph{software engineering} and other essential fields used in \emph{Detect and Avoid} systems.

\paragraph{Conceptual scheme:} The overall concept of \emph{Detect and Avoid Framework} (fig. \ref{fig:avoidanceConcept}) is taking architecture from LSTS tool chain \cite{pinto2013lsts,pinto2012implementation}. The UAS part is based on \emph{LSTS Dune} and it can be easily integrated in future. 

\begin{enumerate}
    \item \emph{Continuous control} - is not solved in this work, its kept in scheme for reference. 
    
    \item \emph{Discrete control} - it bridges event based \emph{Detect and Avoid} core functionality with \emph{Continuous control}. Its covered by \emph{Movement Automaton} (sec. \ref{s:movementAutomatonTheory}).
    
    \item \emph{Event based control} - covers major functionalists:    
    \begin{enumerate}[a.]
        \item \emph{Sensor (Data) fusion} - the main feed of information, implementation of \emph{sensor fusion} (sec. \ref{s:SensorFusionDefinition}) and \emph{data fusion} (sec. \ref{s:dataFusionDefinition}) contributing the avoidance events, introduced in (sec. \ref{s:dataFusionProbabilisticModelTheory}).
        
        \item \emph{Mission plan} - feeding actual goal and objectives to \emph{Navigation Algorithm} (sec. \ref{s:NavigationAlgorithms}) and obeying \emph{UTM directives} (sec. \ref{s:utmServicesTheory}).
        
        \item \emph{Avoidance Grid}  - using mainly \emph{Approximation of Reachable Space} (sec. \ref{s:ReachSetEstimationTheory}) in \emph{Avoidance Maneuver Estimation}.
        
        \item \emph{Rule engine} - enforcing UTM directives (sec. \ref{s:utmServicesTheory}).
    \end{enumerate}
    
\end{enumerate}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{\FIGDIR/TE001BlockSchemeOfControlConcept} 
    \caption{Obstacle avoidance based on Reach sets concept.}
    \label{fig:avoidanceConcept}
\end{figure}

\section{(R) Movement Automaton}\label{s:movementAutomatonTheory}

\paragraph{Idea:} The key idea is to create \emph{interface} between \emph{controlled plant} (UAV) and \emph{Avoidance Algorithm} to ensure \emph{Concept Reusability} at maximum degree.  The concept is following:

\begin{enumerate}

    \item \emph{Interface consumes} discrete command chain and guides UAS along \emph{desired trajectory}.
    
    \item \emph{Interface} can be used to \emph{predict trajectory} based on \emph{initial state} and future command chaining. 
\end{enumerate}

Frazolli provided the concept of \emph{Movement Automaton} (def. \ref{def:movementAutomaton}) a specialized type of \emph{Hybrid Automaton} (eq. \ref{eq:hybridAutomaton}), the concept is taken from his works \cite{frazzoli2001robust,frazzoli2000trajectory}. Other aspects and similarities are discussed over this chapter. 


\paragraph{Architecture:} The Movement Automaton can be seen as a consistent hierarchical abstraction of the continuous dynamics, in the sense outlined in \cite{pappas2000hierarchically}: \emph{Any sequence of movement primitives generated by the Movement Automaton results by construction in a trajectory which is executable by the full continuous system. We will give a deeper meaning to hierarchical consistency}. The implementation of our movement automaton is given in (fig.\ref{fig:avoidanceConcep}). 

\paragraph{Optimal Path Generation:} If the maneuvers are instantaneous (i.e. the UAS can transition instantaneously between two different trim trajectories), Reduction of stronger results obtained by Dubins \cite{dubins1957curves} and Reeds \cite{reeds1990optimal} concerning optimal paths for kinematic cars on the plane (see also \cite{soueres1998optimal}). 

\paragraph{Controllability:} The systems controlled by Movement Automaton (as in \cite{lavalle1998rapidly}), is controllable according to our definition, even though it is not
small-time controllable \cite{sussmann1983lie}.

\paragraph{Other Properties:} The other properties of movement automaton, like \emph{Stability, Robustness} and other important control properties are proven in \cite{frazzoli2001robust}.



\paragraph{Example:} The \emph{example} is given in (fig. \ref{fig:movementAutomatonExampleTheory}). The \emph{States} (Barrels) are connected by \emph{Transitions} (green arrows).

\emph{Hover} is neutral and \emph{initial} state, in this place the UAS stays on place and maintains altitude.

\emph{Forward flight} is when \emph{UAS} is flying in frontal direction with constant speed. The speed-up and slow-down is incorporated in \emph{Transition} between \emph{Hover} and \emph{Forward flight} states and its takes some time to execute. \emph{Transitions} between Turning states and \emph{Flight forward} state are almost instant. 

\emph{Steady turn left/right} is when \emph{UAS} is flying in frontal direction and starts steady turning left or right. 

\begin{note}
UAS in (fig. \ref{fig:movementAutomatonExampleTheory}) ignores the vertical maneuvering and it is expected to fly on horizontal plane.
\end{note}


\begin{figure}[H]
    \centering
    \includegraphics[width=0.55\linewidth]{\FIGDIR/TE030MovementAutomatonFrazzCite} 
    \caption{Movement Automaton for Copter UAS \cite{frazzoli2001robust}.}
    \label{fig:movementAutomatonExampleTheory}
\end{figure}

\paragraph{Used concepts:} The movement automaton is essential part of this work. Supporting the idea, that \emph{Obstacle avoidance framework} can be platform independent. 

The \emph{Movement Automaton} is used as is (sec. \ref{s:MovementAutomatonDefinitionAndProperties}). The implementation is described in (sec. \ref{s:modelMAImplementation}). The testing configuration was given in (tab. \ref{tab:testMovementOrientations}).


\section{(R) Sensor (Data) Fusion - Input Interface}\label{s:dataFusionProbabilisticModelTheory}
\paragraph{Idea:}  There is \emph{Need for abstract representation} of \emph{operational space}, which is independent of used sensors, technologies, information sources. The universal obstacle avoidance system should have \emph{portability property}. Our previous work \emph{Obstacle avoidance framework based on reach sets} \cite{gomola2017obstacle} have introduced similar concept of \emph{control interface}.

The original concept was using cell status interpretation, which was hardwired to LiDAR technology.  The new demand is to incorporate concepts of \emph{visibility}, \emph{reachibility} and \emph{obstacle probability}.. 

\paragraph{Key Concept:} \emph{Data fusion interface} (sec. \ref{def:s:dataFusionDefinition}) - interface to fuse sense data from various online, offline, cooperative, non-cooperative sources into single scalable {space and trajectory evaluation procedure}.
    
\paragraph{Related work:} \noindent UAS specific sensor fusion has been proposed by Ramsay in \cite{ramasamy2014avionics}. \emph{Next generation avoidance concept} \cite{ramasamy2014next} is introducing concept of higher level sensor fusion called \emph{data fusion}. 

The uncertainty and properties in \emph{Remotely Piloted Systems} have been discussed in \cite{chynchenko2016remotely}. The work provided concept of various performance ratings like visibility and obstacle rating, more details have been given in \cite{shmelova2016modeling}. This ratings were modeled only for operator decision making \cite{kharchenko2017modelling}, results are usable for automated decision making and space assessment. 

\emph{Probabilistic trajectory assessment} has been firstly proposed in \cite{kim2007uav} where trajectory was tracking and predicting \emph{safety properties} along. 

\emph{Game theory} viewpoint is firstly used in \cite{vidal2002probabilistic}. Probabilistic path planning using safety zones similar to cell classification of this work have been used in \cite{pfeiffer2005path}.

Probabilistic path search similar to our reach set representation using rapidly exploring path trees have been used in \cite{kothari2013probabilistically,blackmore2006probabilistic}. Relationship between classic grid search and probabilistic lattice search have been established in \cite{lavalle2004relationship}. A probabilistic approach for trajectory estimation via reduced lattice search is known from 1986 from work of Gessel \cite{gessel1986probabilistic} lattice paths were enumerated via movement sequences and similar technique is used in our reach set estimation method using movement automaton. 

Overall concepts of probabilistic sets have been given by Hirota in \cite{hirota1981concepts}.  Free flight safety rating similar to our reachability concept have been presented in \cite{hoekstra2002designing}.

\paragraph{Shortcomings:} 

\begin{enumerate}
    \item \emph{Hierarchical calculation} - there is need to calculate \emph{avoidance trajectory} for incremental constraint applications. For example:
    \begin{enumerate}[a.]
        \item Calculate \emph{Minimal escape path} covering physical obstacles and intruders.
        \item Apply next level of constraints, like airspace restrictions and some virtual constraints. Then calculate path if exists, continue.
        \item Apply nice to have constraints, like non lethal weather, recalculate path.
    \end{enumerate}
    
    \item \emph{Source Reliability Evaluation} -  reliability evaluation is empirical process usually done by hand. The result aggregation is not standardized. There can be multiple sources of same rating, for example visibility, which needs to be aggregated into one.  
    
    \item \emph{Ambiguous rating definition} - There is multiple definitions especially for \emph{Reachibility rating} in works \cite{kothari2013probabilistically,blackmore2006probabilistic,gessel1986probabilistic}.
    
\end{enumerate}

\paragraph{Improvements in Our Work:}

\emph{Hierarchical calculation} is addressed in \emph{Mission Control run} (sec: \ref{s:missionControlRun}) where threats are hierarchically applied based on \emph{severity}.

\emph{Source reliability evaluation} is addressed in \emph{Static Obstacles} (sec. \ref{s:staticObstacles}) and \emph{Moving Obstacles} \ref{s:intruders}). The main rating for \emph{Detected obstacle, Map Obstacle} and \emph{Visibility} of space are established there. 

\emph{Clear rating definition} - the \emph{Reachibility} of space portion and \emph{Safety} rating for trajectory are established in \emph{Avoidance Grid Run} (sec. \ref{s:aviudabceGridRun})



\section{(W) Navigation Algorithms}\label{s:NavigationAlgorithms}


\paragraph{Standard Navigation:}
4D Descent \cite{lim2018energy}
4D Navigation \cite{gardi2018multi}

\paragraph{Hybrid Automaton Path Planning:} A hybrid automaton path planing based on $A*$ algorithm was given by Richards in \cite{richards2004hybrid}. The key idea was to use \emph{hybrid automaton} (eq. \ref{eq:hybridAutomaton}) as a reference generator. This idea was taken and formulated as \emph{Movement Automaton Predictor mode}. 

The similar idea where \emph{potential fields} were used as \emph{intruder model} and path was re-planned  based on events is given in \cite{dong2011hybrid}.

\paragraph{Mode Switch:} The \emph{Mode Switch Control} idea has been presented in \cite{ryan2005mode}. There were definition of behavioural switch between:
\begin{enumerate}
    \item \emph{Navigation Mode} - navigation control and behaviour was used.
    \item \emph{Task Specific Mode} - mode specific for taks, authors were using modes for search and rescue. 
\end{enumerate}

This concept will be reused, the \emph{Task specific mode} will be \emph{Emergency Avoidance Mode} in Our case. The triggering events and switch conditions will be defined in (sec. \ref{s:missionControlRun}).


\section{(R) Reach Set Estimation}\label{s:ReachSetEstimationTheory}
\paragraph{Idea:} The basic idea for \emph{Discrete Reach set Estimation  method} is taken from \cite{ljungqvist2017lattice}. The focus of their work is to generate paths that are kinematically feasible. Path following controllers in order to find techniques to stabilize the system around these paths \cite{ljungqvist2016path,evestedt2016path}. 

Lattice-based planners have been deployed with great success on several robotic platforms \cite{pivtoraiko2009differentially,urmson2008william,cirillo2017videogames}. However, a problem with lattice-based approaches is the exponential complexity in the dimension of the state space which can limit the use for more complicated models.

The optimization problem was solved real-time by \emph{Avocado solver} \cite{houska2011acado}.

\paragraph{Example:} The \emph{example of movement lattice} is given in (fig. \ref{fig:latticeMovementPrimitivesExample}). Truck (black rectangle) is towing Trailer (red rectangle). The \emph{state} have only one \emph{reach set impacting variable} - \emph{trailer displacement}. When trailer displacement is $0^{\circ}$ (fig. \ref{fig:noDisplacementLattuce}) the lattice representation of \emph{Reach Set} is different that in case of small left/right tilt (fig. \ref{fig:displacementleftrightlattuce}).

\begin{figure}[H]
    \centering
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=0.9\linewidth]{\FIGDIR/TE028LattuceMovementSet01}
        \caption{Trailer displacement $0^{\circ}$.}
        \label{fig:noDisplacementLattuce}
    \end{subfigure}
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=0.9\linewidth]{\FIGDIR/TE029LattuceMovementSe02t} 
        \caption{$12^{\circ}$ (green) $-12^{\circ}$ (blue).}
        \label{fig:displacementleftrightlattuce}
    \end{subfigure}
    
    \caption{\emph{Movement set primitives} for Lattice Based Movement Planning. \cite{ljungqvist2017lattice}. }
    \label{fig:latticeMovementPrimitivesExample}
\end{figure}

\paragraph{Benefits:} Presented method of \emph{Lattice Search}  is  de-facto \emph{Reduced Reach Set Approximation} in open space for \emph{Truck-Trailer} system. 

The idea of \emph{Movement primitives} is very close to \emph{Movement Automaton} (def. \ref{def:movementAutomaton}), which can be used as \emph{control interface} effectively. 

The \emph{Constraints} of obstacle set in \emph{Known world} (sec. \ref{s:KnownWorld}) are supported to some degree.

\paragraph{Shortcomings:} There are following shortcomings which were identified in this approach:
\begin{enumerate}
    \item \emph{Limited system dimension} - given method works in \emph{real time} only if dimension of \emph{system state space} does not exceed $4^{th}$  rank.
    
    \item \emph{Real time optimization} - real time optimization is main cause of \emph{limited system dimension}. If the decision time can be discrete (which movement automaton enforces) then offline optimization  can be used. 
    
    \item \emph{Continuous space disparity} - the example (fig. \ref{fig:latticeMovementPrimitivesExample}) shows there are member variables of \emph{State Space} which significantly impacts the shape of lattice (reach set estimation). This is not a problem in real-time environment. The discretization of \emph{Time domain} raises this as a shortcoming.
    
    \item \emph{Trajectory Tracking} - approach generates \emph{Continuous Domain} reference signal. For \emph{Discrete Domain} it is necessary to address this issue.
\end{enumerate}

\paragraph{Improvements in Our Work:}

\emph{Limited system dimension} - the discretization due the higher system dimension and  increased maneuver complexity goes hand-in-hand with \emph{pre-calculation} of the \emph{Reach Set}. This shortcoming is addressed in (sec. \ref{s:constrainedTrajectoryExpansion}).

\emph{Real time optimization} -  replaced by \emph{Discrete offline optimization problem}. The \emph{general cost function} is given in (eq. \ref{eq:costFunctionReachable}). The optimization problem solved in this work is defined in (eq. \ref{eq:trajectoryTrackingOptimalizaitonProblem}).

\emph{Continuous space disparity} - The \emph{pre-calculated reach set estimation} can be valid with small \emph{marginal error} for some region in \emph{system state space}. The dynamic method for state space segmentation can be used \cite{takahashi1996reasonable}. This aspect is not addressed in this work, because it is strongly depending on the system behind movement automaton. 

\emph{Trajectory Tracking} - The \emph{movement automaton} (def. \ref{def:movementAutomaton}) in Control Mode can be used to track reference trajectory in form of \emph{Movement Buffer}(def. \ref{def:MovementBuffer}). Other option is to use \emph{thick waypoint trajectory tracking for UAV} like in \cite{kaminer1998trajectory} or \cite{murillo2015generalized}. The work will use only \emph{Movement Automaton} as controller/predictor. 




\section{(W) Testing Framework}\label{s:TestingFrameworkTheory}

\paragraph{Movement Automaton Control} Marconi used \emph{hybrid automaton} with forced \emph{State Switch} via buffer \cite{marconi2009control}. The key concept is that \emph{Automata} state switch is forced as \emph{external source command}. Our \emph{Movement Automaton} implementation know only \emph{forced state switch} like in \cite{frazzoli2000trajectory}. 

\section{(W) UTM Services}\label{s:utmServicesTheory}
\paragraph{Trajectory performanc tracking:} TODO 4D Trajectory \cite{gardi20154} 
\paragraph{Rule engine:}





	